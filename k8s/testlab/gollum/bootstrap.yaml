apiVersion: batch/v1
kind: Job
metadata:
  name: gollum-bootstrap
  namespace: gollum
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: false
        runAsUser: 999
        runAsGroup: 999
        fsGroup: 999
        fsGroupChangePolicy: OnRootMismatch
        seccompProfile:
          type: RuntimeDefault
      restartPolicy: OnFailure
      containers:
        - name: init-clone-repo
          image: alpine/git
          imagePullPolicy: Always
          args:
            - clone
            - '--single-branch'
            - '--'
            - 'https://github.com/luminosita/wiki'
            - '/wiki/repo'
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /wiki
              name: gollum-repo
      volumes:
        - name: gollum-repo
          persistentVolumeClaim:
            claimName: pvc-gollum

