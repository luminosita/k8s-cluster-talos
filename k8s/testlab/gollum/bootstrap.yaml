apiVersion: batch/v1
kind: Job
metadata:
  name: gollum-bootstrap
  namespace: gollum
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        # - name: init-myservice
        #   image: busybox:1.28
        #   command: 
        #     - 'sh'
        #     - '-c' 
        #     - "rm -rf /wiki/*; git clone https://github.com/luminosita/wiki /wiki"
        - name: init-clone-repo
          image: alpine/git
          imagePullPolicy: Always
          command:
            - 'sh'
            - '-c' 
            - "git clone https://github.com/luminosita/wiki /tmp/wiki; rm -rf /wiki*; cp -r /tmp/wiki/* /wiki"
          # args:
          #   - clone
          #   - '--single-branch'
          #   - '--'
          #   - 'https://github.com/luminosita/wiki'
          #   - '/wiki'
          # env:
          # - name: GIT_USERNAME
          #   valueFrom:
          #     secretKeyRef:
          #       key: username
          #       name: test-secret
          # - name: GIT_PASSWORD
          #   valueFrom:
          #     secretKeyRef:
          #       key: password
          #       name: test-secret
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /wiki
              name: gollum-repo
      volumes:
        - name: gollum-repo
          persistentVolumeClaim:
            claimName: pvc-gollum

